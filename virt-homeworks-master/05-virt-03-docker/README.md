
# Домашнее задание к занятию 3. «Введение. Экосистема. Архитектура. Жизненный цикл Docker-контейнера»

## Как сдавать задания

Обязательны к выполнению задачи без звёздочки. Их нужно выполнить, чтобы получить зачёт и диплом о профессиональной переподготовке.

Задачи со звёздочкой (*) — дополнительные задачи и/или задачи повышенной сложности. Их выполнять не обязательно, но они помогут вам глубже понять тему.

Домашнее задание выполните в файле readme.md в GitHub-репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

Любые вопросы по решению задач задавайте в чате учебной группы.

---


## Важно

**Перед началом работы над дипломным заданием изучите [Инструкция по экономии облачных ресурсов](https://github.com/netology-code/devops-materials/blob/master/cloudwork.MD).**

Перед отправкой работы на проверку удаляйте неиспользуемые ресурсы.
Это нужно, чтобы не расходовать средства, полученные в результате использования промокода.

Подробные рекомендации [здесь](https://github.com/netology-code/virt-homeworks/blob/virt-11/r/README.md).

---

## Задача 1

Сценарий выполнения задачи:

- создайте свой репозиторий на https://hub.docker.com;
- выберите любой образ, который содержит веб-сервер Nginx;
- создайте свой fork образа;
- реализуйте функциональность:
запуск веб-сервера в фоне с индекс-страницей, содержащей HTML-код ниже:
```
<html>
<head>
Hey, Netology
</head>
<body>
<h1>I’m DevOps Engineer!</h1>
</body>
</html>
```

Опубликуйте созданный fork в своём репозитории и предоставьте ответ в виде ссылки на https://hub.docker.com/username_repo.

#### Ответ:
1. Создал [Dockerfile](res/Dockerfile)
2. Собрал образ командой `docker build -t olmicron/ng-05-virt-03-01:1.0.0 .`
3. Залил в хаб командой `docker push olmicron/ng-05-virt-03-01:1.0.0`
4. Результат тут: https://hub.docker.com/r/olmicron/ng-05-virt-03-01

## Задача 2

Посмотрите на сценарий ниже и ответьте на вопрос:
«Подходит ли в этом сценарии использование Docker-контейнеров или лучше подойдёт виртуальная машина, физическая машина? Может быть, возможны разные варианты?»

Детально опишите и обоснуйте свой выбор.

--

Сценарий:

1. высоконагруженное монолитное Java веб-приложение; 
2. Nodejs веб-приложение; 
3. мобильное приложение c версиями для Android и iOS; 
4. шина данных на базе Apache Kafka; 
5. Elasticsearch-кластер для реализации логирования продуктивного веб-приложения — три ноды elasticsearch, два logstash и две ноды kibana; 
6. мониторинг-стек на базе Prometheus и Grafana; 
7. MongoDB как основное хранилище данных для Java-приложения;
8. Gitlab-сервер для реализации CI/CD-процессов и приватный (закрытый) Docker Registry.

#### Ответ: 
1. Если высоконагруженное и монолитное, то по моему, разницы особо нет, но да, на хостовой машине запускать его будет наверное немножечко выгоднее (небольшой + к производительности), но в докере всё же удобнее т.к. легко можно масштабировать и обновить (просто заменив контейнер).
2. Как на хосте, так и в докере (я бы запустил в докере).
3. Тут докер наверное не очень подойдёт, хотя эмулятор (если тут о нём речь, а иначе не понятно о чём тогда) можно запустить и там и там, но всё же на хосте он будет работать стабильнее и быстрее, чем через посредников.
4. Пока не очень понятно для чего оно используется, маппер данных между приложениями? Если да, то запустил бы в контейнере, т.у. легко запустить, изменить и масштабировать.
5. Однозначно контейнеры, т.к. возиться со всем этим в ручную - не имеет смысла, когда есть уже готовые контейнеры, взял и запустил, плюсом легкое масштабирование.
6. Тоже самое, контейнеры, т.к. уже есть всё готовое и работающее...
7. Контейнер. Но не уверен, один ли или несколько (будет ли профит от нескольких на одном хосте или только хуже, это же касается других БД, типо postgresql?). На данный момент думаю что одного контейнера на хост хватит, а если нет реплик то всего 1 контейнер на одном хосте. Почему контейнер - потому что проще обновить, как саму БД, так и конфигурацию и т.п.
8. Тут я бы использовал оба способа, сам гитлаб сервер возможно запустил бы на хостовой машине, а CI/CD в контейнерах. А на счет приватного Docker Registry не уверен, может тоже на хосте, хотя для удобства наверное контейнер.

## Задача 3

- Запустите первый контейнер из образа ***centos*** c любым тегом в фоновом режиме, подключив папку ```/data``` из текущей рабочей директории на хостовой машине в ```/data``` контейнера.
- Запустите второй контейнер из образа ***debian*** в фоновом режиме, подключив папку ```/data``` из текущей рабочей директории на хостовой машине в ```/data``` контейнера.
- Подключитесь к первому контейнеру с помощью ```docker exec``` и создайте текстовый файл любого содержания в ```/data```.
- Добавьте ещё один файл в папку ```/data``` на хостовой машине.
- Подключитесь во второй контейнер и отобразите листинг и содержание файлов в ```/data``` контейнера.

#### Ответ:

Запустил контейнеры с использованием `sleep infinity`, иначе контейнеры сразу завершаются, командами:
```bash 
docker run -d --name centos -v D:\DevOps\git_netology\netology-full\virt-homeworks-master\05-virt-03-docker\res/data:/data centos sleep infinity
docker run -d --name debian -v D:\DevOps\git_netology\netology-full\virt-homeworks-master\05-virt-03-docker\res/data:/data debian sleep infinity

docker run -d --name centos -v [absolute_path]/data:/data centos sleep infinity
docker run -d --name debian -v [absolute_path]/data:/data debian sleep infinity
```
_P.S. Вместо `[absolute_path]` указывал полный путь до директории `data` на хостовой машине._

```text
PS > docker ps
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES
6fbc21c0b117   debian    "sleep infinity"         2 minutes ago    Up 2 minutes              debian
cd7821a23e36   centos    "sleep infinity"         3 minutes ago    Up 3 minutes              centos
```

Подключаюсь к первому контейнеру и создаю файл:
```ini
PS > docker exec -it centos bash

[root@cd7821a23e36 /]# ls -l /data 
total 0

[root@cd7821a23e36 /]# echo "qqq" > /data/centos-file

[root@cd7821a23e36 /]# ls -l /data
total 0
-rw-r--r-- 1 root root    4 Mar 17 22:28 centos-file
```

После создаю файл на хостовой машине, листинг в контейнере:
```ini
[root@cd7821a23e36 /]# ls -l /data
total 0
-rw-r--r-- 1 root root 4 Mar 17 22:28 centos-file
-rwxrwxrwx 1 root root 3 Mar 17 22:31 host-file
```

Подключаюсь ко второму контейнеру и вывожу листинг файлов:
```ini
PS > docker exec -it debian bash

root@6fbc21c0b117:/# ls -l /data/
total 0
-rw-r--r-- 1 root root 4 Mar 17 22:28 centos-file
-rwxrwxrwx 1 root root 3 Mar 17 22:31 host-file

```

П.С. Хост у меня на windows.


## Задача 4 (*)

Воспроизведите практическую часть лекции самостоятельно.

Соберите Docker-образ с Ansible, загрузите на Docker Hub и пришлите ссылку вместе с остальными ответами к задачам.


---

### Как cдавать задание

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---

