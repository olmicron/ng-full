# Домашнее задание к занятию 12.8. «Резервное копирование баз данных»

**Домашнее задание выполните в Google Docs или в md-файле в вашем репозитории GitHub.** 

Для оформления вашего решения в GitHub можете воспользоваться [шаблоном](https://github.com/netology-code/sys-pattern-homework).

Название файла должно содержать номер лекции и фамилию студента. Пример названия: «12.8. Резервное копирование баз данных — Александр Александров».

Перед тем как выслать ссылку, убедитесь, что её содержимое не является приватным, то есть открыто на просмотр всем, у кого есть ссылка. Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

---

#### Ответ

1.1. Подойдут в данном случае, по моему, инкрементный, дифференциальный и полный бэкапы.

Вариант 1 - с полными бэкапами: Полный бекап делаем например в ночь с воскресенья на понедельник (и далее каждую ночь). Соответственно для восстановления просто берём нужный бэкап...

Вариант 2 - с инкрементным бэкапом: Также делаем полный бэкап в ночь с воскресенья на понедельник, и далее инкрементный бэкап каждый день (можно и каждый час, или чаще, но упростим). Для восстановления, соответственно берём полный бэкап и бэкапы по всем предыдущим дням до нужного дня. Например, если надо четверг, то берём полный, + понедельник, вторник, среда и четверг.

Вариант 3 - с дифференциальным бэкапом: Тоже самое что и в инкрементном, но только для восстановления берём полный бэкап и диф. бэкап за дань, на который надо восстановить данные. Например нужен четверг - берём фулл бэкап и бэкап за четверг.

_П.С. Я бы выбрал вариант 2, хотя, если данных не много - то и вариант 1 подойдёт._

1.2. В данном случае инкрементный. Бэкапы делать раз в неделю полный и далее каждый час инкрементный. 

1.3.* Насчёт моментального переключения, при поломке, на "починенную" БД - не совсем понятно, если имеется ввиду что база поломалась, её починили и она мгновенно вошла в строй - думаю да, при мастер-слэйв режиме работы БД предполагаю такое может быть. Собственно, а при "поломке" БД и "мгновенном" переключении на другую - да. 

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.2.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

#### Ответ

2.1.
```shell 
# -d, как и остальные аргументы можно не указывать
# Здесь сразу сжимаем дамп
pg_dump -d db_name -h localhost -cE UTF-8 | gzip > /backups/bd_dump.gz
# Не уверен, что можно восстановить БД напрмую из архива, возможно надо будет распаковать хотя бы в *.tar 
pg_restore -d db_name /backups/bd_dump.gz
```

2.2.* Автоматизировать создание бэкапа - да, самое простое - крон'ом. А вот восстановление - тоже думаю - да, либо какими-то сторонним ПО, либо своими скриптами. Но на данный момент (у меня не хватает знаний для оценки необходимости оного), я бы не делал автовосстановление, только ручное, а то мало ли...  

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.2.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

3.1. 
```shell
mysqlbackup --defaults-file=/etc/mysql/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/backups \
  --backup-image=incremental_image1.bi \
   backup-to-image
```

3.2.* Я думаю что в любом случае, т.к. с реплики можно читать, что ускоряет работу с БД, с реплики возможно можно создавать копии, не останавливая остальные реплики/мастер...

---

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.
